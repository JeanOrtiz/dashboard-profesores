import { __decorate } from "tslib";
import { Component, ViewChild, Input, } from "@angular/core";
import { MatPaginator } from "@angular/material/paginator";
import { MatSort } from "@angular/material/sort";
import { MatTable } from "@angular/material/table";
import { DataTableDataSource } from "./ng-m-datatable.datasource";
import { FormGroup, FormBuilder } from "@angular/forms";
var NgMDatatable = /** @class */ (function () {
    function NgMDatatable(fb) {
        var _this = this;
        this.data = [];
        this.showSpinner = true;
        this.searchForm = fb.group({
            search: [""],
        });
        this.searchForm.valueChanges.subscribe(function (v) {
            _this.dataSource.data = _this.filter(v.search);
            _this.paginator._changePageSize(_this.paginator.pageSize);
        });
    }
    NgMDatatable.prototype.ngOnInit = function () {
        this.dataSource = new DataTableDataSource(this.data || []);
    };
    NgMDatatable.prototype.asAction = function (c) {
        return c;
    };
    NgMDatatable.prototype.filter = function (searchName) {
        return searchName && searchName.trim()
            ? this.data.filter(function (x) {
                for (var key in x) {
                    if (x[key].toString().toLowerCase().includes(searchName.toLowerCase()))
                        return x;
                }
            })
            : this.data;
    };
    NgMDatatable.prototype.ngAfterViewInit = function () {
        this.dataSource.data = this.data || [];
        this.dataSource.sort = this.sort;
        this.dataSource.paginator = this.paginator;
        this.table.dataSource = this.dataSource;
        this.tableBg = window.getComputedStyle(document.getElementById("klk")).background;
        this.tableColor = window.getComputedStyle(document.querySelector(".mat-header-cell")).color;
        document
            .querySelector(".table-container")
            .setAttribute("style", "background : " + this.tableBg + "; color : " + this.tableColor);
        if (this.data.length > 0)
            this.toggleLoading(false);
    };
    NgMDatatable.prototype.toggleLoading = function (v) {
        this.showSpinner = v;
        var el = document.querySelector("#loading");
        if (el)
            el.setAttribute("style", "border-color : " + this.tableColor + ";");
    };
    NgMDatatable.prototype.ngOnChanges = function (changes) {
        console.log("changes", changes);
        if (changes.data && !changes.data.firstChange) {
            this.dataSource.data = this.data || [];
            this.toggleLoading(false);
            this.paginator._changePageSize(this.paginator.pageSize);
        }
    };
    NgMDatatable.ctorParameters = function () { return [
        { type: FormBuilder }
    ]; };
    __decorate([
        ViewChild(MatPaginator, { static: false })
    ], NgMDatatable.prototype, "paginator", void 0);
    __decorate([
        ViewChild(MatSort, { static: false })
    ], NgMDatatable.prototype, "sort", void 0);
    __decorate([
        ViewChild(MatTable, { static: false })
    ], NgMDatatable.prototype, "table", void 0);
    __decorate([
        Input()
    ], NgMDatatable.prototype, "options", void 0);
    __decorate([
        Input()
    ], NgMDatatable.prototype, "data", void 0);
    NgMDatatable = __decorate([
        Component({
            selector: "data-table",
            template: "<div class=\"table-container mat-elevation-z8\">\n  <div class=\"table-header\">\n    <div class=\"f-left\">\n      <h2>\n        <button\n          *ngIf=\"options?.addButton\"\n          (click)=\"options?.addButton.handler()\"\n          mat-icon-button\n          aria-label=\"Example icon-button with a heart icon\"\n        >\n          <mat-icon>{{ options?.addButton.icon }}</mat-icon>\n        </button>\n        {{ options?.title }}\n      </h2>\n    </div>\n    <form\n      class=\"mat-header-cell\"\n      [formGroup]=\"searchForm\"\n      class=\"\"\n      class=\"f-right\"\n    >\n      <mat-form-field class=\"example-full-width\">\n        <mat-icon matPrefix>search</mat-icon>\n        <mat-label>Search</mat-label>\n        <input formControlName=\"search\" matInput placeholder=\"...\" value=\"\" />\n      </mat-form-field>\n    </form>\n  </div>\n  <table mat-table class=\"full-width-table\" matSort aria-label=\"Elements\">\n    <ng-container *ngFor=\"let c of options?.columns\">\n      <ng-container [matColumnDef]=\"c.id\">\n        <th\n          [ngClass]=\"{ 't-right': c.type == 'action' }\"\n          mat-header-cell\n          *matHeaderCellDef\n          mat-sort-header\n        >\n          {{ c.text }}\n        </th>\n        <td mat-cell *matCellDef=\"let row\">\n          <ng-container *ngIf=\"c.type == 'text' || !c.type\">\n            {{ row[c.id] }}</ng-container\n          >\n          <ng-container *ngIf=\"c.type == 'action'\">\n            <button\n              class=\"f-right\"\n              mat-icon-button\n              [matMenuTriggerFor]=\"menu\"\n              aria-label=\"Example icon-button with a menu\"\n            >\n              <mat-icon>more_vert</mat-icon>\n            </button>\n            <mat-menu #menu=\"matMenu\">\n              <button\n                *ngFor=\"let a of asAction(c).actions\"\n                [disabled]=\"a.disabled\"\n                (click)=\"a.handler(row)\"\n                data-toggle=\"modal\"\n                data-target=\"#add-serviceCats-modal\"\n                mat-menu-item\n              >\n                <mat-icon>{{ a.icon }}</mat-icon>\n                <span>{{ a.text }}</span>\n              </button>\n            </mat-menu>\n          </ng-container>\n        </td>\n      </ng-container>\n    </ng-container>\n\n    <tr\n      id=\"klk\"\n      mat-header-row\n      *matHeaderRowDef=\"options?.displayedColumns\"\n    ></tr>\n    <tr mat-row *matRowDef=\"let row; columns: options?.displayedColumns\"></tr>\n  </table>\n  <div *ngIf=\"dataSource.data.length < 1 && !showSpinner\" class=\"\">\n    <h3 style=\"text-align: center;\">\n      No elements\n    </h3>\n  </div>\n  <div\n    *ngIf=\"showSpinner\"\n    style=\"width: 100%;\"\n    class=\"d-flex justify-content-center\"\n  >\n    <div style=\"margin: 5px auto;\" class=\"lds-ripple\">\n      <div></div>\n      <div style=\"border-color: green;\"></div>\n    </div>\n  </div>\n\n  <mat-paginator\n    #paginator\n    [length]=\"dataSource?.data.length\"\n    [pageIndex]=\"0\"\n    [pageSize]=\"50\"\n    [pageSizeOptions]=\"[25, 50, 100, 250]\"\n  >\n  </mat-paginator>\n</div>\n",
            styles: ["*{box-sizing:border-box}.full-width-table{width:100%}.t-right{display:flex;padding:21px 0;justify-content:flex-end}.data-table{width:80%;margin:20px auto}.lds-ripple{position:relative;width:80px;height:80px}.lds-ripple div{position:absolute;border:4px solid #4b3d3d;opacity:1;border-radius:50%;-webkit-animation:1s cubic-bezier(0,.2,.8,1) infinite lds-ripple;animation:1s cubic-bezier(0,.2,.8,1) infinite lds-ripple}.lds-ripple div:nth-child(2){-webkit-animation-delay:-.5s;animation-delay:-.5s}@-webkit-keyframes lds-ripple{0%{top:36px;left:36px;width:0;height:0;opacity:1}100%{top:0;left:0;width:72px;height:72px;opacity:0}}@keyframes lds-ripple{0%{top:36px;left:36px;width:0;height:0;opacity:1}100%{top:0;left:0;width:72px;height:72px;opacity:0}}.table-container{padding:20px 5px;width:100%}.table-header{margin:0 40px}.f-right{float:right}.f-left{float:left}table{max-height:80vh}table.mat-table{border-spacing:0;width:100%;display:block;overflow-x:auto}.mat-table{width:100%;max-width:100%;display:table;border-collapse:collapse;margin:0}.mat-header-row,.mat-row{display:table-row}.mat-cell,.mat-header-cell{word-wrap:initial;display:table-cell;padding:0 5px;line-break:unset;width:100%;white-space:nowrap;overflow:hidden;vertical-align:middle}.mat-header-row{position:sticky;position:-webkit-sticky;top:0;z-index:1;background-color:inherit}"]
        })
    ], NgMDatatable);
    return NgMDatatable;
}());
export { NgMDatatable };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmctbS1kYXRhdGFibGUuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vbWF0ZWgtbmctbS1kYXRhdGFibGUvIiwic291cmNlcyI6WyJsaWIvbmctbS1kYXRhdGFibGUuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBRUwsU0FBUyxFQUVULFNBQVMsRUFDVCxLQUFLLEdBS04sTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLDZCQUE2QixDQUFDO0FBQzNELE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUNqRCxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0seUJBQXlCLENBQUM7QUFDbkQsT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0sNkJBQTZCLENBQUM7QUFDbEUsT0FBTyxFQUFFLFNBQVMsRUFBRSxXQUFXLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQW1DeEQ7SUFlRSxzQkFBWSxFQUFlO1FBQTNCLGlCQVNDO1FBakJRLFNBQUksR0FBYSxFQUFFLENBQUM7UUFHN0IsZ0JBQVcsR0FBRyxJQUFJLENBQUM7UUFNakIsSUFBSSxDQUFDLFVBQVUsR0FBRyxFQUFFLENBQUMsS0FBSyxDQUFDO1lBQ3pCLE1BQU0sRUFBRSxDQUFDLEVBQUUsQ0FBQztTQUNiLENBQUMsQ0FBQztRQUVILElBQUksQ0FBQyxVQUFVLENBQUMsWUFBWSxDQUFDLFNBQVMsQ0FBQyxVQUFDLENBQUM7WUFDdkMsS0FBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLEdBQUcsS0FBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDN0MsS0FBSSxDQUFDLFNBQVMsQ0FBQyxlQUFlLENBQUMsS0FBSSxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUMxRCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFRCwrQkFBUSxHQUFSO1FBQ0UsSUFBSSxDQUFDLFVB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LENBQUMsT0FBTyxFQUFFLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSxDQUFDOzhDQUFlO0lBQ2I7UUFBdkMsU0FBUyxDQUFDLFFBQVEsRUFBRSxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUUsQ0FBQzsrQ0FBb0I7SUFHbEQ7UUFBUixLQUFLLEVBQUU7aURBQWlDO0lBQ2hDO1FBQVIsS0FBSyxFQUFFOzhDQUFxQjtJQVBsQixZQUFZO1FBTHhCLFNBQVMsQ0FBQztZQUNULFFBQVEsRUFBRSxZQUFZO1lBQ3RCLDRtR0FBOEM7O1NBRS9DLENBQUM7T0FDVyxZQUFZLENBb0Z4QjtJQUFELG1CQUFDO0NBQUEsQUFwRkQsSUFvRkM7U0FwRlksWUFBWSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIEFmdGVyVmlld0luaXQsXG4gIENvbXBvbmVudCxcbiAgT25Jbml0LFxuICBWaWV3Q2hpbGQsXG4gIElucHV0LFxuICBPbkNoYW5nZXMsXG4gIFNpbXBsZUNoYW5nZXMsXG4gIEVsZW1lbnRSZWYsXG4gIEFmdGVyVmlld0NoZWNrZWQsXG59IGZyb20gXCJAYW5ndWxhci9jb3JlXCI7XG5pbXBvcnQgeyBNYXRQYWdpbmF0b3IgfSBmcm9tIFwiQGFuZ3VsYXIvbWF0ZXJpYWwvcGFnaW5hdG9yXCI7XG5pbXBvcnQgeyBNYXRTb3J0IH0gZnJvbSBcIkBhbmd1bGFyL21hdGVyaWFsL3NvcnRcIjtcbmltcG9ydCB7IE1hdFRhYmxlIH0gZnJvbSBcIkBhbmd1bGFyL21hdGVyaWFsL3RhYmxlXCI7XG5pbXBvcnQgeyBEYXRhVGFibGVEYXRhU291cmNlIH0gZnJvbSBcIi4vbmctbS1kYXRhdGFibGUuZGF0YXNvdXJjZVwiO1xuaW1wb3J0IHsgRm9ybUdyb3VwLCBGb3JtQnVpbGRlciB9IGZyb20gXCJAYW5ndWxhci9mb3Jtc1wiO1xuXG5leHBvcnQgaW50ZXJmYWNlIE5nTURhdGF0YWJsZU9wdGlvbnM8VD4ge1xuICBjb2x1bW5zOiBBcnJheTxUZXh0Q29sdW1uIHwgQWN0aW9uQ29sdW1uPFQ+PjtcbiAgZGlzcGxheWVkQ29sdW1uczogU3RyaW5nW107XG4gIHRpdGxlPzogU3RyaW5nO1xuICBhZGRCdXR0b24/OiB7XG4gICAgaWNvbjogc3RyaW5nO1xuICAgIGhhbmRsZXI6ICgpID0+IHZvaWQ7XG4gIH07XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVGV4dENvbHVtbiB7XG4gIGlkOiBzdHJpbmc7XG4gIHRleHQ6IHN0cmluZztcbiAgdHlwZT86IFwidGV4dFwiO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEFjdGlvbkNvbHVtbjxUPiB7XG4gIGlkOiBzdHJpbmc7XG4gIHRleHQ6IHN0cmluZztcbiAgdHlwZTogXCJhY3Rpb25cIjtcbiAgYWN0aW9uczogQXJyYXk8e1xuICAgIHRleHQ6IHN0cmluZztcbiAgICBoYW5kbGVyOiAoZGF0YTogVCkgPT4gdm9pZDtcbiAgICBpY29uOiBzdHJpbmc7XG4gICAgZGlzYWJsZWQ/OiBzdHJpbmc7XG4gIH0+O1xufVxuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6IFwiZGF0YS10YWJsZVwiLFxuICB0ZW1wbGF0ZVVybDogXCIuL25nLW0tZGF0YXRhYmxlLmNvbXBvbmVudC5odG1sXCIsXG4gIHN0eWxlVXJsczogW1wiLi9uZy1tLWRhdGF0YWJsZS5jb21wb25lbnQuY3NzXCJdLFxufSlcbmV4cG9ydCBjbGFzcyBOZ01EYXRhdGFibGU8VD4gaW1wbGVtZW50cyBPbkluaXQsIE9uQ2hhbmdlcywgQWZ0ZXJWaWV3SW5pdCB7XG4gIEBWaWV3Q2hpbGQoTWF0UGFnaW5hdG9yLCB7IHN0YXRpYzogZmFsc2UgfSkgcGFnaW5hdG9yOiBNYXRQYWdpbmF0b3I7XG4gIEBWaWV3Q2hpbGQoTWF0U29ydCwgeyBzdGF0aWM6IGZhbHNlIH0pIHNvcnQ6IE1hdFNvcnQ7XG4gIEBWaWV3Q2hpbGQoTWF0VGFibGUsIHsgc3RhdGljOiBmYWxzZSB9KSB0YWJsZTogTWF0VGFibGU8VD47XG4gIHRhYmxlSFRNTDogRWxlbWVudFJlZjtcblxuICBASW5wdXQoKSBvcHRpb25zOiBOZ01EYXRhdGFibGVPcHRpb25zPFQ+O1xuICBASW5wdXQoKSBkYXRhOiBBcnJheTxUPiA9IFtdO1xuXG4gIGRhdGFTb3VyY2U6IERhdGFUYWJsZURhdGFTb3VyY2U8VD47XG4gIHNob3dTcGlubmVyID0gdHJ1ZTtcbiAgdGFibGVDb2xvcjogc3RyaW5nO1xuICB0YWJsZUJnOiBzdHJpbmc7XG4gIHNlYXJjaEZvcm06IEZvcm1Hcm91cDtcblxuICBjb25zdHJ1Y3RvcihmYjogRm9ybUJ1aWxkZXIpIHtcbiAgICB0aGlzLnNlYXJjaEZvcm0gPSBmYi5ncm91cCh7XG4gICAgICBzZWFyY2g6IFtcIlwiXSxcbiAgICB9KTtcblxuICAgIHRoaXMuc2VhcmNoRm9ybS52YWx1ZUNoYW5nZXMuc3Vic2NyaWJlKCh2KSA9PiB7XG4gICAgICB0aGlzLmRhdGFTb3VyY2UuZGF0YSA9IHRoaXMuZmlsdGVyKHYuc2VhcmNoKTtcbiAgICAgIHRoaXMucGFnaW5hdG9yLl9jaGFuZ2VQYWdlU2l6ZSh0aGlzLnBhZ2luYXRvci5wYWdlU2l6ZSk7XG4gICAgfSk7XG4gIH1cblxuICBuZ09uSW5pdCgpIHtcbiAgICB0aGlzLmRhdGFTb3VyY2UgPSBuZXcgRGF0YVRhYmxlRGF0YVNvdXJjZTxUPih0aGlzLmRhdGEgfHwgW10pO1xuICB9XG5cbiAgYXNBY3Rpb24oYzogVGV4dENvbHVtbiB8IEFjdGlvbkNvbHVtbjxUPikge1xuICAgIHJldHVybiBjIGFzIEFjdGlvbkNvbHVtbjxUPjtcbiAgfVxuXG4gIGZpbHRlcihzZWFyY2hOYW1lOiBzdHJpbmcpOiBhbnkge1xuICAgIHJldHVybiBzZWFyY2hOYW1lICYmIHNlYXJjaE5hbWUudHJpbSgpXG4gICAgICA/IHRoaXMuZGF0YS5maWx0ZXIoKHgpID0+IHtcbiAgICAgICAgICBmb3IgKGNvbnN0IGtleSBpbiB4KSB7XG4gICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgIHhba2V5XS50b1N0cmluZygpLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoc2VhcmNoTmFtZS50b0xvd2VyQ2FzZSgpKVxuICAgICAgICAgICAgKVxuICAgICAgICAgICAgICByZXR1cm4geDtcbiAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgICA6IHRoaXMuZGF0YTtcbiAgfVxuXG4gIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcbiAgICB0aGlzLmRhdGFTb3VyY2UuZGF0YSA9IHRoaXMuZGF0YSB8fCBbXTtcblxuICAgIHRoaXMuZGF0YVNvdXJjZS5zb3J0ID0gdGhpcy5zb3J0O1xuICAgIHRoaXMuZGF0YVNvdXJjZS5wYWdpbmF0b3IgPSB0aGlzLnBhZ2luYXRvcjtcbiAgICB0aGlzLnRhYmxlLmRhdGFTb3VyY2UgPSB0aGlzLmRhdGFTb3VyY2U7XG5cbiAgICB0aGlzLnRhYmxlQmcgPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShcbiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwia2xrXCIpXG4gICAgKS5iYWNrZ3JvdW5kO1xuICAgIHRoaXMudGFibGVDb2xvciA9IHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKFxuICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5tYXQtaGVhZGVyLWNlbGxcIilcbiAgICApLmNvbG9yO1xuICAgIGRvY3VtZW50XG4gICAgICAucXVlcnlTZWxlY3RvcihcIi50YWJsZS1jb250YWluZXJcIilcbiAgICAgIC5zZXRBdHRyaWJ1dGUoXG4gICAgICAgIFwic3R5bGVcIixcbiAgICAgICAgYGJhY2tncm91bmQgOiAke3RoaXMudGFibGVCZ307IGNvbG9yIDogJHt0aGlzLnRhYmxlQ29sb3J9YFxuICAgICAgKTtcblxuICAgIGlmICh0aGlzLmRhdGEubGVuZ3RoID4gMCkgdGhpcy50b2dnbGVMb2FkaW5nKGZhbHNlKTtcbiAgfVxuXG4gIHRvZ2dsZUxvYWRpbmcodjogYm9vbGVhbikge1xuICAgIHRoaXMuc2hvd1NwaW5uZXIgPSB2O1xuICAgIGNvbnN0IGVsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNsb2FkaW5nXCIpO1xuICAgIGlmIChlbCkgZWwuc2V0QXR0cmlidXRlKFwic3R5bGVcIiwgYGJvcmRlci1jb2xvciA6ICR7dGhpcy50YWJsZUNvbG9yfTtgKTtcbiAgfVxuXG4gIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpIHtcbiAgICBjb25zb2xlLmxvZyhcImNoYW5nZXNcIiwgY2hhbmdlcyk7XG4gICAgaWYgKGNoYW5nZXMuZGF0YSAmJiAhY2hhbmdlcy5kYXRhLmZpcnN0Q2hhbmdlKSB7XG4gICAgICB0aGlzLmRhdGFTb3VyY2UhLmRhdGEgPSB0aGlzLmRhdGEgfHwgW107XG4gICAgICB0aGlzLnRvZ2dsZUxvYWRpbmcoZmFsc2UpO1xuICAgICAgdGhpcy5wYWdpbmF0b3IuX2NoYW5nZVBhZ2VTaXplKHRoaXMucGFnaW5hdG9yLnBhZ2VTaXplKTtcbiAgICB9XG4gIH1cbn1cbiJdfQ==