import { __decorate } from "tslib";
import { Component, ViewChild, Input, } from "@angular/core";
import { MatPaginator } from "@angular/material/paginator";
import { MatSort } from "@angular/material/sort";
import { MatTable } from "@angular/material/table";
import { DataTableDataSource } from "./ng-m-datatable.datasource";
import { FormGroup, FormBuilder } from "@angular/forms";
let NgMDatatable = class NgMDatatable {
    constructor(fb) {
        this.data = [];
        this.showSpinner = true;
        this.searchForm = fb.group({
            search: [""],
        });
        this.searchForm.valueChanges.subscribe((v) => {
            this.dataSource.data = this.filter(v.search);
            this.paginator._changePageSize(this.paginator.pageSize);
        });
    }
    ngOnInit() {
        this.dataSource = new DataTableDataSource(this.data || []);
    }
    asAction(c) {
        return c;
    }
    filter(searchName) {
        return searchName && searchName.trim()
            ? this.data.filter((x) => {
                for (const key in x) {
                    if (x[key].toString().toLowerCase().includes(searchName.toLowerCase()))
                        return x;
                }
            })
            : this.data;
    }
    ngAfterViewInit() {
        this.dataSource.data = this.data || [];
        this.dataSource.sort = this.sort;
        this.dataSource.paginator = this.paginator;
        this.table.dataSource = this.dataSource;
        this.tableBg = window.getComputedStyle(document.getElementById("klk")).background;
        this.tableColor = window.getComputedStyle(document.querySelector(".mat-header-cell")).color;
        document
            .querySelector(".table-container")
            .setAttribute("style", `background : ${this.tableBg}; color : ${this.tableColor}`);
        if (this.data.length > 0)
            this.toggleLoading(false);
    }
    toggleLoading(v) {
        this.showSpinner = v;
        const el = document.querySelector("#loading");
        if (el)
            el.setAttribute("style", `border-color : ${this.tableColor};`);
    }
    ngOnChanges(changes) {
        console.log("changes", changes);
        if (changes.data && !changes.data.firstChange) {
            this.dataSource.data = this.data || [];
            this.toggleLoading(false);
            this.paginator._changePageSize(this.paginator.pageSize);
        }
    }
};
NgMDatatable.ctorParameters = () => [
    { type: FormBuilder }
];
__decorate([
    ViewChild(MatPaginator, { static: false })
], NgMDatatable.prototype, "paginator", void 0);
__decorate([
    ViewChild(MatSort, { static: false })
], NgMDatatable.prototype, "sort", void 0);
__decorate([
    ViewChild(MatTable, { static: false })
], NgMDatatable.prototype, "table", void 0);
__decorate([
    Input()
], NgMDatatable.prototype, "options", void 0);
__decorate([
    Input()
], NgMDatatable.prototype, "data", void 0);
NgMDatatable = __decorate([
    Component({
        selector: "data-table",
        template: "<div class=\"table-container mat-elevation-z8\">\n  <div class=\"table-header\">\n    <div class=\"f-left\">\n      <h2>\n        <button\n          *ngIf=\"options?.addButton\"\n          (click)=\"options?.addButton.handler()\"\n          mat-icon-button\n          aria-label=\"Example icon-button with a heart icon\"\n        >\n          <mat-icon>{{ options?.addButton.icon }}</mat-icon>\n        </button>\n        {{ options?.title }}\n      </h2>\n    </div>\n    <form\n      class=\"mat-header-cell\"\n      [formGroup]=\"searchForm\"\n      class=\"\"\n      class=\"f-right\"\n    >\n      <mat-form-field class=\"example-full-width\">\n        <mat-icon matPrefix>search</mat-icon>\n        <mat-label>Search</mat-label>\n        <input formControlName=\"search\" matInput placeholder=\"...\" value=\"\" />\n      </mat-form-field>\n    </form>\n  </div>\n  <table mat-table class=\"full-width-table\" matSort aria-label=\"Elements\">\n    <ng-container *ngFor=\"let c of options?.columns\">\n      <ng-container [matColumnDef]=\"c.id\">\n        <th\n          [ngClass]=\"{ 't-right': c.type == 'action' }\"\n          mat-header-cell\n          *matHeaderCellDef\n          mat-sort-header\n        >\n          {{ c.text }}\n        </th>\n        <td mat-cell *matCellDef=\"let row\">\n          <ng-container *ngIf=\"c.type == 'text' || !c.type\">\n            {{ row[c.id] }}</ng-container\n          >\n          <ng-container *ngIf=\"c.type == 'action'\">\n            <button\n              class=\"f-right\"\n              mat-icon-button\n              [matMenuTriggerFor]=\"menu\"\n              aria-label=\"Example icon-button with a menu\"\n            >\n              <mat-icon>more_vert</mat-icon>\n            </button>\n            <mat-menu #menu=\"matMenu\">\n              <button\n                *ngFor=\"let a of asAction(c).actions\"\n                [disabled]=\"a.disabled\"\n                (click)=\"a.handler(row)\"\n                data-toggle=\"modal\"\n                data-target=\"#add-serviceCats-modal\"\n                mat-menu-item\n              >\n                <mat-icon>{{ a.icon }}</mat-icon>\n                <span>{{ a.text }}</span>\n              </button>\n            </mat-menu>\n          </ng-container>\n        </td>\n      </ng-container>\n    </ng-container>\n\n    <tr\n      id=\"klk\"\n      mat-header-row\n      *matHeaderRowDef=\"options?.displayedColumns\"\n    ></tr>\n    <tr mat-row *matRowDef=\"let row; columns: options?.displayedColumns\"></tr>\n  </table>\n  <div *ngIf=\"dataSource.data.length < 1 && !showSpinner\" class=\"\">\n    <h3 style=\"text-align: center;\">\n      No elements\n    </h3>\n  </div>\n  <div\n    *ngIf=\"showSpinner\"\n    style=\"width: 100%;\"\n    class=\"d-flex justify-content-center\"\n  >\n    <div style=\"margin: 5px auto;\" class=\"lds-ripple\">\n      <div></div>\n      <div style=\"border-color: green;\"></div>\n    </div>\n  </div>\n\n  <mat-paginator\n    #paginator\n    [length]=\"dataSource?.data.length\"\n    [pageIndex]=\"0\"\n    [pageSize]=\"50\"\n    [pageSizeOptions]=\"[25, 50, 100, 250]\"\n  >\n  </mat-paginator>\n</div>\n",
        styles: ["*{box-sizing:border-box}.full-width-table{width:100%}.t-right{display:flex;padding:21px 0;justify-content:flex-end}.data-table{width:80%;margin:20px auto}.lds-ripple{position:relative;width:80px;height:80px}.lds-ripple div{position:absolute;border:4px solid #4b3d3d;opacity:1;border-radius:50%;-webkit-animation:1s cubic-bezier(0,.2,.8,1) infinite lds-ripple;animation:1s cubic-bezier(0,.2,.8,1) infinite lds-ripple}.lds-ripple div:nth-child(2){-webkit-animation-delay:-.5s;animation-delay:-.5s}@-webkit-keyframes lds-ripple{0%{top:36px;left:36px;width:0;height:0;opacity:1}100%{top:0;left:0;width:72px;height:72px;opacity:0}}@keyframes lds-ripple{0%{top:36px;left:36px;width:0;height:0;opacity:1}100%{top:0;left:0;width:72px;height:72px;opacity:0}}.table-container{padding:20px 5px;width:100%}.table-header{margin:0 40px}.f-right{float:right}.f-left{float:left}table{max-height:80vh}table.mat-table{border-spacing:0;width:100%;display:block;overflow-x:auto}.mat-table{width:100%;max-width:100%;display:table;border-collapse:collapse;margin:0}.mat-header-row,.mat-row{display:table-row}.mat-cell,.mat-header-cell{word-wrap:initial;display:table-cell;padding:0 5px;line-break:unset;width:100%;white-space:nowrap;overflow:hidden;vertical-align:middle}.mat-header-row{position:sticky;position:-webkit-sticky;top:0;z-index:1;background-color:inherit}"]
    })
], NgMDatatable);
export { NgMDatatable };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmctbS1kYXRhdGFibGUuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vbWF0ZWgtbmctbS1kYXRhdGFibGUvIiwic291cmNlcyI6WyJsaWIvbmctbS1kYXRhdGFibGUuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBRUwsU0FBUyxFQUVULFNBQVMsRUFDVCxLQUFLLEdBS04sTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLDZCQUE2QixDQUFDO0FBQzNELE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUNqRCxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0seUJBQXlCLENBQUM7QUFDbkQsT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0sNkJBQTZCLENBQUM7QUFDbEUsT0FBTyxFQUFFLFNBQVMsRUFBRSxXQUFXLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQW1DeEQsSUFBYSxZQUFZLEdBQXpCLE1BQWEsWUFBWTtJQWV2QixZQUFZLEVBQWU7UUFSbEIsU0FBSSxHQUFhLEVBQUUsQ0FBQztRQUc3QixnQkFBVyxHQUFHLElBQUksQ0FBQztRQU1qQixJQUFJLENBQUMsVUFBVSxHQUFHLEVBQUUsQ0FBQyxLQUFLLENBQUM7WUFDekIsTUFBTSxFQUFFLENBQUMsRUFBRSxDQUFDO1NBQ2IsQ0FBQyxDQUFDO1FBRUgsSUFBSSxDQUFDLFVBQVUsQ0FBQyxZQUFZLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUU7WUFDM0MsSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDN0MsSUFBSSxDQUFDLFNBQVMsQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUMxRCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFRCxRQUFR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QjtJQUF0QyxTQUFTLENBQUMsT0FBTyxFQUFFLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSxDQUFDOzBDQUFlO0FBQ2I7SUFBdkMsU0FBUyxDQUFDLFFBQVEsRUFBRSxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUUsQ0FBQzsyQ0FBb0I7QUFHbEQ7SUFBUixLQUFLLEVBQUU7NkNBQWlDO0FBQ2hDO0lBQVIsS0FBSyxFQUFFOzBDQUFxQjtBQVBsQixZQUFZO0lBTHhCLFNBQVMsQ0FBQztRQUNULFFBQVEsRUFBRSxZQUFZO1FBQ3RCLDRtR0FBOEM7O0tBRS9DLENBQUM7R0FDVyxZQUFZLENBb0Z4QjtTQXBGWSxZQUFZIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQWZ0ZXJWaWV3SW5pdCxcbiAgQ29tcG9uZW50LFxuICBPbkluaXQsXG4gIFZpZXdDaGlsZCxcbiAgSW5wdXQsXG4gIE9uQ2hhbmdlcyxcbiAgU2ltcGxlQ2hhbmdlcyxcbiAgRWxlbWVudFJlZixcbiAgQWZ0ZXJWaWV3Q2hlY2tlZCxcbn0gZnJvbSBcIkBhbmd1bGFyL2NvcmVcIjtcbmltcG9ydCB7IE1hdFBhZ2luYXRvciB9IGZyb20gXCJAYW5ndWxhci9tYXRlcmlhbC9wYWdpbmF0b3JcIjtcbmltcG9ydCB7IE1hdFNvcnQgfSBmcm9tIFwiQGFuZ3VsYXIvbWF0ZXJpYWwvc29ydFwiO1xuaW1wb3J0IHsgTWF0VGFibGUgfSBmcm9tIFwiQGFuZ3VsYXIvbWF0ZXJpYWwvdGFibGVcIjtcbmltcG9ydCB7IERhdGFUYWJsZURhdGFTb3VyY2UgfSBmcm9tIFwiLi9uZy1tLWRhdGF0YWJsZS5kYXRhc291cmNlXCI7XG5pbXBvcnQgeyBGb3JtR3JvdXAsIEZvcm1CdWlsZGVyIH0gZnJvbSBcIkBhbmd1bGFyL2Zvcm1zXCI7XG5cbmV4cG9ydCBpbnRlcmZhY2UgTmdNRGF0YXRhYmxlT3B0aW9uczxUPiB7XG4gIGNvbHVtbnM6IEFycmF5PFRleHRDb2x1bW4gfCBBY3Rpb25Db2x1bW48VD4+O1xuICBkaXNwbGF5ZWRDb2x1bW5zOiBTdHJpbmdbXTtcbiAgdGl0bGU/OiBTdHJpbmc7XG4gIGFkZEJ1dHRvbj86IHtcbiAgICBpY29uOiBzdHJpbmc7XG4gICAgaGFuZGxlcjogKCkgPT4gdm9pZDtcbiAgfTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBUZXh0Q29sdW1uIHtcbiAgaWQ6IHN0cmluZztcbiAgdGV4dDogc3RyaW5nO1xuICB0eXBlPzogXCJ0ZXh0XCI7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQWN0aW9uQ29sdW1uPFQ+IHtcbiAgaWQ6IHN0cmluZztcbiAgdGV4dDogc3RyaW5nO1xuICB0eXBlOiBcImFjdGlvblwiO1xuICBhY3Rpb25zOiBBcnJheTx7XG4gICAgdGV4dDogc3RyaW5nO1xuICAgIGhhbmRsZXI6IChkYXRhOiBUKSA9PiB2b2lkO1xuICAgIGljb246IHN0cmluZztcbiAgICBkaXNhYmxlZD86IHN0cmluZztcbiAgfT47XG59XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogXCJkYXRhLXRhYmxlXCIsXG4gIHRlbXBsYXRlVXJsOiBcIi4vbmctbS1kYXRhdGFibGUuY29tcG9uZW50Lmh0bWxcIixcbiAgc3R5bGVVcmxzOiBbXCIuL25nLW0tZGF0YXRhYmxlLmNvbXBvbmVudC5jc3NcIl0sXG59KVxuZXhwb3J0IGNsYXNzIE5nTURhdGF0YWJsZTxUPiBpbXBsZW1lbnRzIE9uSW5pdCwgT25DaGFuZ2VzLCBBZnRlclZpZXdJbml0IHtcbiAgQFZpZXdDaGlsZChNYXRQYWdpbmF0b3IsIHsgc3RhdGljOiBmYWxzZSB9KSBwYWdpbmF0b3I6IE1hdFBhZ2luYXRvcjtcbiAgQFZpZXdDaGlsZChNYXRTb3J0LCB7IHN0YXRpYzogZmFsc2UgfSkgc29ydDogTWF0U29ydDtcbiAgQFZpZXdDaGlsZChNYXRUYWJsZSwgeyBzdGF0aWM6IGZhbHNlIH0pIHRhYmxlOiBNYXRUYWJsZTxUPjtcbiAgdGFibGVIVE1MOiBFbGVtZW50UmVmO1xuXG4gIEBJbnB1dCgpIG9wdGlvbnM6IE5nTURhdGF0YWJsZU9wdGlvbnM8VD47XG4gIEBJbnB1dCgpIGRhdGE6IEFycmF5PFQ+ID0gW107XG5cbiAgZGF0YVNvdXJjZTogRGF0YVRhYmxlRGF0YVNvdXJjZTxUPjtcbiAgc2hvd1NwaW5uZXIgPSB0cnVlO1xuICB0YWJsZUNvbG9yOiBzdHJpbmc7XG4gIHRhYmxlQmc6IHN0cmluZztcbiAgc2VhcmNoRm9ybTogRm9ybUdyb3VwO1xuXG4gIGNvbnN0cnVjdG9yKGZiOiBGb3JtQnVpbGRlcikge1xuICAgIHRoaXMuc2VhcmNoRm9ybSA9IGZiLmdyb3VwKHtcbiAgICAgIHNlYXJjaDogW1wiXCJdLFxuICAgIH0pO1xuXG4gICAgdGhpcy5zZWFyY2hGb3JtLnZhbHVlQ2hhbmdlcy5zdWJzY3JpYmUoKHYpID0+IHtcbiAgICAgIHRoaXMuZGF0YVNvdXJjZS5kYXRhID0gdGhpcy5maWx0ZXIodi5zZWFyY2gpO1xuICAgICAgdGhpcy5wYWdpbmF0b3IuX2NoYW5nZVBhZ2VTaXplKHRoaXMucGFnaW5hdG9yLnBhZ2VTaXplKTtcbiAgICB9KTtcbiAgfVxuXG4gIG5nT25Jbml0KCkge1xuICAgIHRoaXMuZGF0YVNvdXJjZSA9IG5ldyBEYXRhVGFibGVEYXRhU291cmNlPFQ+KHRoaXMuZGF0YSB8fCBbXSk7XG4gIH1cblxuICBhc0FjdGlvbihjOiBUZXh0Q29sdW1uIHwgQWN0aW9uQ29sdW1uPFQ+KSB7XG4gICAgcmV0dXJuIGMgYXMgQWN0aW9uQ29sdW1uPFQ+O1xuICB9XG5cbiAgZmlsdGVyKHNlYXJjaE5hbWU6IHN0cmluZyk6IGFueSB7XG4gICAgcmV0dXJuIHNlYXJjaE5hbWUgJiYgc2VhcmNoTmFtZS50cmltKClcbiAgICAgID8gdGhpcy5kYXRhLmZpbHRlcigoeCkgPT4ge1xuICAgICAgICAgIGZvciAoY29uc3Qga2V5IGluIHgpIHtcbiAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgeFtrZXldLnRvU3RyaW5nKCkudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhzZWFyY2hOYW1lLnRvTG93ZXJDYXNlKCkpXG4gICAgICAgICAgICApXG4gICAgICAgICAgICAgIHJldHVybiB4O1xuICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICAgIDogdGhpcy5kYXRhO1xuICB9XG5cbiAgbmdBZnRlclZpZXdJbml0KCkge1xuICAgIHRoaXMuZGF0YVNvdXJjZS5kYXRhID0gdGhpcy5kYXRhIHx8IFtdO1xuXG4gICAgdGhpcy5kYXRhU291cmNlLnNvcnQgPSB0aGlzLnNvcnQ7XG4gICAgdGhpcy5kYXRhU291cmNlLnBhZ2luYXRvciA9IHRoaXMucGFnaW5hdG9yO1xuICAgIHRoaXMudGFibGUuZGF0YVNvdXJjZSA9IHRoaXMuZGF0YVNvdXJjZTtcblxuICAgIHRoaXMudGFibGVCZyA9IHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKFxuICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJrbGtcIilcbiAgICApLmJhY2tncm91bmQ7XG4gICAgdGhpcy50YWJsZUNvbG9yID0gd2luZG93LmdldENvbXB1dGVkU3R5bGUoXG4gICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLm1hdC1oZWFkZXItY2VsbFwiKVxuICAgICkuY29sb3I7XG4gICAgZG9jdW1lbnRcbiAgICAgIC5xdWVyeVNlbGVjdG9yKFwiLnRhYmxlLWNvbnRhaW5lclwiKVxuICAgICAgLnNldEF0dHJpYnV0ZShcbiAgICAgICAgXCJzdHlsZVwiLFxuICAgICAgICBgYmFja2dyb3VuZCA6ICR7dGhpcy50YWJsZUJnfTsgY29sb3IgOiAke3RoaXMudGFibGVDb2xvcn1gXG4gICAgICApO1xuXG4gICAgaWYgKHRoaXMuZGF0YS5sZW5ndGggPiAwKSB0aGlzLnRvZ2dsZUxvYWRpbmcoZmFsc2UpO1xuICB9XG5cbiAgdG9nZ2xlTG9hZGluZyh2OiBib29sZWFuKSB7XG4gICAgdGhpcy5zaG93U3Bpbm5lciA9IHY7XG4gICAgY29uc3QgZWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2xvYWRpbmdcIik7XG4gICAgaWYgKGVsKSBlbC5zZXRBdHRyaWJ1dGUoXCJzdHlsZVwiLCBgYm9yZGVyLWNvbG9yIDogJHt0aGlzLnRhYmxlQ29sb3J9O2ApO1xuICB9XG5cbiAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcykge1xuICAgIGNvbnNvbGUubG9nKFwiY2hhbmdlc1wiLCBjaGFuZ2VzKTtcbiAgICBpZiAoY2hhbmdlcy5kYXRhICYmICFjaGFuZ2VzLmRhdGEuZmlyc3RDaGFuZ2UpIHtcbiAgICAgIHRoaXMuZGF0YVNvdXJjZSEuZGF0YSA9IHRoaXMuZGF0YSB8fCBbXTtcbiAgICAgIHRoaXMudG9nZ2xlTG9hZGluZyhmYWxzZSk7XG4gICAgICB0aGlzLnBhZ2luYXRvci5fY2hhbmdlUGFnZVNpemUodGhpcy5wYWdpbmF0b3IucGFnZVNpemUpO1xuICAgIH1cbiAgfVxufVxuIl19