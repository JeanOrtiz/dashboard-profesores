import { __decorate, __read, __spread } from "tslib";
import { ViewChildren, ElementRef } from "@angular/core";
import { FormControlName, FormGroup, FormArray, } from "@angular/forms";
import { fromEvent, merge } from "rxjs";
import { debounceTime } from "rxjs/operators";
var FormComponentBase = /** @class */ (function () {
    function FormComponentBase() {
        this.validationMessages = {};
        this.formErrors = {};
    }
    FormComponentBase.prototype.startControlMonitoring = function (form, unsubscribePreviousForm) {
        var _this = this;
        if (unsubscribePreviousForm === void 0) { unsubscribePreviousForm = false; }
        if (unsubscribePreviousForm) {
            this.mySubs.unsubscribe();
        }
        // Watch for the blur event from any input element on the form.
        //  This is required because the valueChanges does not provide notification on blur.
        this.subscribe(form, this.formInputElements.toArray());
        this.formInputElements.changes.subscribe(function (inputs) {
            _this.subscribe(form, inputs.toArray());
        });
    };
    FormComponentBase.prototype.subscribe = function (form, inputsArray) {
        var _this = this;
        // console.log(inputsArray);
        var controlBlurs = inputsArray.map(function (formControl) {
            return fromEvent(formControl.nativeElement, "blur");
        });
        // Merge the blur event observable with the valueChanges observable so we only need to subscribe once.
        this.mySubs = merge.apply(void 0, __spread([form.valueChanges], controlBlurs)).pipe(debounceTime(300))
            .subscribe(function (value) {
            _this.logValidationErrors(form);
        });
    };
    FormComponentBase.prototype.logValidationErrors = function (group) {
        var _this = this;
        Object.keys(group.controls).forEach(function (key) {
            var abstractControl = group.get(key);
            _this.formErrors[key] = "";
            // console.log(key, abstractControl.invalid, abstractControl.touched, abstractControl.dirty);
            if (abstractControl &&
                !abstractControl.valid &&
                (abstractControl.touched || abstractControl.dirty)) {
                var messages = _this.validationMessages[key];
                for (var errorKey in abstractControl.errors) {
                    if (errorKey) {
                        _this.formErrors[key] += messages[errorKey] + " ";
                    }
                }
            }
            // console.log(this.formErrors);
            if (abstractControl instanceof FormGroup ||
                abstractControl instanceof FormArray) {
                _this.logValidationErrors(abstractControl);
            }
        });
    };
    FormComponentBase.prototype.atLeastOneCheckboxCheckedValidator = function (minRequired) {
        if (minRequired === void 0) { minRequired = 1; }
        return function validate(formGroup) {
            var checked = 0;
            Object.keys(formGroup.controls).forEach(function (key) {
                var control = formGroup.controls[key];
                if (control.value) {
                    checked++;
                }
            });
            if (checked < minRequired) {
                return {
                    requireCheckboxToBeChecked: true,
                };
            }
            return null;
        };
    };
    FormComponentBase.prototype.passwordsMustMatchValidator = function () {
        return function (group) {
            var currentPassword = group.get("password");
            var newPassword = group.get("confirmPassword");
            if (currentPassword && newPassword) {
                if (currentPassword.pristine || newPassword.pristine) {
                    return null;
                }
                if (currentPassword.value !== newPassword.value) {
                    return { passwordsMustMatch: true };
                }
            }
            return null;
        };
    };
    FormComponentBase.prototype.ngOnDestroy = function () {
        this.mySubs.unsubscribe();
    };
    __decorate([
        ViewChildren(FormControlName, { read: ElementRef })
    ], FormComponentBase.prototype, "formInputElements", void 0);
    return FormComponentBase;
}());
export { FormComponentBase };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZm9ybS1jb21wb25lbnQtYmFzZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL21hdGVoLW5nLW0tdmFsaWRhdGlvbi8iLCJzb3VyY2VzIjpbImxpYi9mb3JtLWNvbXBvbmVudC1iYXNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUUsWUFBWSxFQUFFLFVBQVUsRUFBd0IsTUFBTSxlQUFlLENBQUM7QUFDL0UsT0FBTyxFQUNMLGVBQWUsRUFDZixTQUFTLEVBQ1QsU0FBUyxHQUdWLE1BQU0sZ0JBQWdCLENBQUM7QUFDeEIsT0FBTyxFQUFjLFNBQVMsRUFBRSxLQUFLLEVBQTRCLE1BQU0sTUFBTSxDQUFDO0FBQzlFLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUU5QztJQUFBO1FBSVMsdUJBQWtCLEdBQWlELEVBQUUsQ0FBQztRQUN0RSxlQUFVLEdBQThCLEVBQUUsQ0FBQztJQTRHcEQsQ0FBQztJQXhHVyxrREFBc0IsR0FBaEMsVUFDRSxJQUFlLEVBQ2YsdUJBQStCO1FBRmpDLGlCQWdCQztRQWRDLHdDQUFBLEVBQUEsK0JBQStCO1FBRS9CLElBQUksdUJBQXVCLEVBQUU7WUFDM0IsSUFBSSxDQUFDLE1BQU0sQ0FBQyxXQUFXLEVBQUUsQ0FBQztTQUMzQjtRQUNELCtEQUErRDtRQUMvRCxvRkFBb0Y7UUFDcEYsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLGlCQUFpQixDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUM7UUFFdkQsSUFBSSxDQUFDLGlCQUFpQixDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQ3RDLFVBQUMsTUFBNkI7WUFDNUIsS0FBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLEVBQUUsTUFBTSxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUM7UUFDekMsQ0FBQyxDQUNGLENBQUM7SUFDSixDQUFDO0lBRU8scUNBQVMsR0FBakIsVUFBa0IsSUFBZSxFQUFFLFdBQXlCO1FBQTVELGlCQWNDO1FB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QUMsS0FBSyxFQUFFO29CQUMvQyxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsSUFBSSxFQUFFLENBQUM7aUJBQ3JDO2FBQ0Y7WUFDRCxPQUFPLElBQUksQ0FBQztRQUNkLENBQUMsQ0FBQztJQUNKLENBQUM7SUFFRCx1Q0FBVyxHQUFYO1FBQ0UsSUFBSSxDQUFDLE1BQU0sQ0FBQyxXQUFXLEVBQUUsQ0FBQztJQUM1QixDQUFDO0lBOUdEO1FBREMsWUFBWSxDQUFDLGVBQWUsRUFBRSxFQUFFLElBQUksRUFBRSxVQUFVLEVBQUUsQ0FBQztnRUFDWDtJQStHM0Msd0JBQUM7Q0FBQSxBQWpIRCxJQWlIQztTQWpIWSxpQkFBaUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBWaWV3Q2hpbGRyZW4sIEVsZW1lbnRSZWYsIFF1ZXJ5TGlzdCwgT25EZXN0cm95IH0gZnJvbSBcIkBhbmd1bGFyL2NvcmVcIjtcbmltcG9ydCB7XG4gIEZvcm1Db250cm9sTmFtZSxcbiAgRm9ybUdyb3VwLFxuICBGb3JtQXJyYXksXG4gIFZhbGlkYXRvckZuLFxuICBWYWxpZGF0aW9uRXJyb3JzLFxufSBmcm9tIFwiQGFuZ3VsYXIvZm9ybXNcIjtcbmltcG9ydCB7IE9ic2VydmFibGUsIGZyb21FdmVudCwgbWVyZ2UsIFN1YnNjcmliZXIsIFN1YnNjcmlwdGlvbiB9IGZyb20gXCJyeGpzXCI7XG5pbXBvcnQgeyBkZWJvdW5jZVRpbWUgfSBmcm9tIFwicnhqcy9vcGVyYXRvcnNcIjtcblxuZXhwb3J0IGNsYXNzIEZvcm1Db21wb25lbnRCYXNlIGltcGxlbWVudHMgT25EZXN0cm95IHtcbiAgQFZpZXdDaGlsZHJlbihGb3JtQ29udHJvbE5hbWUsIHsgcmVhZDogRWxlbWVudFJlZiB9KVxuICBmb3JtSW5wdXRFbGVtZW50czogUXVlcnlMaXN0PEVsZW1lbnRSZWY+O1xuXG4gIHB1YmxpYyB2YWxpZGF0aW9uTWVzc2FnZXM6IHsgW2tleTogc3RyaW5nXTogeyBba2V5OiBzdHJpbmddOiBzdHJpbmcgfSB9ID0ge307XG4gIHB1YmxpYyBmb3JtRXJyb3JzOiB7IFtrZXk6IHN0cmluZ106IHN0cmluZyB9ID0ge307XG5cbiAgbXlTdWJzOiBTdWJzY3JpcHRpb247XG5cbiAgcHJvdGVjdGVkIHN0YXJ0Q29udHJvbE1vbml0b3JpbmcoXG4gICAgZm9ybTogRm9ybUdyb3VwLFxuICAgIHVuc3Vic2NyaWJlUHJldmlvdXNGb3JtID0gZmFsc2VcbiAgKTogdm9pZCB7XG4gICAgaWYgKHVuc3Vic2NyaWJlUHJldmlvdXNGb3JtKSB7XG4gICAgICB0aGlzLm15U3Vicy51bnN1YnNjcmliZSgpO1xuICAgIH1cbiAgICAvLyBXYXRjaCBmb3IgdGhlIGJsdXIgZXZlbnQgZnJvbSBhbnkgaW5wdXQgZWxlbWVudCBvbiB0aGUgZm9ybS5cbiAgICAvLyAgVGhpcyBpcyByZXF1aXJlZCBiZWNhdXNlIHRoZSB2YWx1ZUNoYW5nZXMgZG9lcyBub3QgcHJvdmlkZSBub3RpZmljYXRpb24gb24gYmx1ci5cbiAgICB0aGlzLnN1YnNjcmliZShmb3JtLCB0aGlzLmZvcm1JbnB1dEVsZW1lbnRzLnRvQXJyYXkoKSk7XG5cbiAgICB0aGlzLmZvcm1JbnB1dEVsZW1lbnRzLmNoYW5nZXMuc3Vic2NyaWJlKFxuICAgICAgKGlucHV0czogUXVlcnlMaXN0PEVsZW1lbnRSZWY+KSA9PiB7XG4gICAgICAgIHRoaXMuc3Vic2NyaWJlKGZvcm0sIGlucHV0cy50b0FycmF5KCkpO1xuICAgICAgfVxuICAgICk7XG4gIH1cblxuICBwcml2YXRlIHN1YnNjcmliZShmb3JtOiBGb3JtR3JvdXAsIGlucHV0c0FycmF5OiBFbGVtZW50UmVmW10pIHtcbiAgICAvLyBjb25zb2xlLmxvZyhpbnB1dHNBcnJheSk7XG4gICAgY29uc3QgY29udHJvbEJsdXJzOiBPYnNlcnZhYmxlPFxuICAgICAgYW55XG4gICAgPltdID0gaW5wdXRzQXJyYXkubWFwKChmb3JtQ29udHJvbDogRWxlbWVudFJlZikgPT5cbiAgICAgIGZyb21FdmVudChmb3JtQ29udHJvbC5uYXRpdmVFbGVtZW50LCBcImJsdXJcIilcbiAgICApO1xuXG4gICAgLy8gTWVyZ2UgdGhlIGJsdXIgZXZlbnQgb2JzZXJ2YWJsZSB3aXRoIHRoZSB2YWx1ZUNoYW5nZXMgb2JzZXJ2YWJsZSBzbyB3ZSBvbmx5IG5lZWQgdG8gc3Vic2NyaWJlIG9uY2UuXG4gICAgdGhpcy5teVN1YnMgPSBtZXJnZShmb3JtLnZhbHVlQ2hhbmdlcywgLi4uY29udHJvbEJsdXJzKVxuICAgICAgLnBpcGUoZGVib3VuY2VUaW1lKDMwMCkpXG4gICAgICAuc3Vic2NyaWJlKCh2YWx1ZSkgPT4ge1xuICAgICAgICB0aGlzLmxvZ1ZhbGlkYXRpb25FcnJvcnMoZm9ybSk7XG4gICAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgbG9nVmFsaWRhdGlvbkVycm9ycyhncm91cDogRm9ybUdyb3VwIHwgRm9ybUFycmF5KTogdm9pZCB7XG4gICAgT2JqZWN0LmtleXMoZ3JvdXAuY29udHJvbHMpLmZvckVhY2goKGtleTogc3RyaW5nKSA9PiB7XG4gICAgICBjb25zdCBhYnN0cmFjdENvbnRyb2wgPSBncm91cC5nZXQoa2V5KTtcblxuICAgICAgdGhpcy5mb3JtRXJyb3JzW2tleV0gPSBcIlwiO1xuICAgICAgLy8gY29uc29sZS5sb2coa2V5LCBhYnN0cmFjdENvbnRyb2wuaW52YWxpZCwgYWJzdHJhY3RDb250cm9sLnRvdWNoZWQsIGFic3RyYWN0Q29udHJvbC5kaXJ0eSk7XG4gICAgICBpZiAoXG4gICAgICAgIGFic3RyYWN0Q29udHJvbCAmJlxuICAgICAgICAhYWJzdHJhY3RDb250cm9sLnZhbGlkICYmXG4gICAgICAgIChhYnN0cmFjdENvbnRyb2wudG91Y2hlZCB8fCBhYnN0cmFjdENvbnRyb2wuZGlydHkpXG4gICAgICApIHtcbiAgICAgICAgY29uc3QgbWVzc2FnZXMgPSB0aGlzLnZhbGlkYXRpb25NZXNzYWdlc1trZXldO1xuICAgICAgICBmb3IgKGNvbnN0IGVycm9yS2V5IGluIGFic3RyYWN0Q29udHJvbC5lcnJvcnMpIHtcbiAgICAgICAgICBpZiAoZXJyb3JLZXkpIHtcbiAgICAgICAgICAgIHRoaXMuZm9ybUVycm9yc1trZXldICs9IG1lc3NhZ2VzW2Vycm9yS2V5XSArIFwiIFwiO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgLy8gY29uc29sZS5sb2codGhpcy5mb3JtRXJyb3JzKTtcbiAgICAgIGlmIChcbiAgICAgICAgYWJzdHJhY3RDb250cm9sIGluc3RhbmNlb2YgRm9ybUdyb3VwIHx8XG4gICAgICAgIGFic3RyYWN0Q29udHJvbCBpbnN0YW5jZW9mIEZvcm1BcnJheVxuICAgICAgKSB7XG4gICAgICAgIHRoaXMubG9nVmFsaWRhdGlvbkVycm9ycyhhYnN0cmFjdENvbnRyb2wpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgYXRMZWFzdE9uZUNoZWNrYm94Q2hlY2tlZFZhbGlkYXRvcihtaW5SZXF1aXJlZCA9IDEpOiBWYWxpZGF0b3JGbiB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uIHZhbGlkYXRlKGZvcm1Hcm91cDogRm9ybUdyb3VwIHwgRm9ybUFycmF5KSB7XG4gICAgICBsZXQgY2hlY2tlZCA9IDA7XG5cbiAgICAgIE9iamVjdC5rZXlzKGZvcm1Hcm91cC5jb250cm9scykuZm9yRWFjaCgoa2V5KSA9PiB7XG4gICAgICAgIGNvbnN0IGNvbnRyb2wgPSBmb3JtR3JvdXAuY29udHJvbHNba2V5XTtcblxuICAgICAgICBpZiAoY29udHJvbC52YWx1ZSkge1xuICAgICAgICAgIGNoZWNrZWQrKztcbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIGlmIChjaGVja2VkIDwgbWluUmVxdWlyZWQpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICByZXF1aXJlQ2hlY2tib3hUb0JlQ2hlY2tlZDogdHJ1ZSxcbiAgICAgICAgfTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfTtcbiAgfVxuXG4gIHBhc3N3b3Jkc011c3RNYXRjaFZhbGlkYXRvcigpOiBWYWxpZGF0b3JGbiB7XG4gICAgcmV0dXJuIChncm91cDogRm9ybUdyb3VwKTogVmFsaWRhdGlvbkVycm9ycyB8IG51bGwgPT4ge1xuICAgICAgY29uc3QgY3VycmVudFBhc3N3b3JkID0gZ3JvdXAuZ2V0KFwicGFzc3dvcmRcIik7XG4gICAgICBjb25zdCBuZXdQYXNzd29yZCA9IGdyb3VwLmdldChcImNvbmZpcm1QYXNzd29yZFwiKTtcblxuICAgICAgaWYgKGN1cnJlbnRQYXNzd29yZCAmJiBuZXdQYXNzd29yZCkge1xuICAgICAgICBpZiAoY3VycmVudFBhc3N3b3JkLnByaXN0aW5lIHx8IG5ld1Bhc3N3b3JkLnByaXN0aW5lKSB7XG4gICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGN1cnJlbnRQYXNzd29yZC52YWx1ZSAhPT0gbmV3UGFzc3dvcmQudmFsdWUpIHtcbiAgICAgICAgICByZXR1cm4geyBwYXNzd29yZHNNdXN0TWF0Y2g6IHRydWUgfTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfTtcbiAgfVxuXG4gIG5nT25EZXN0cm95KCkge1xuICAgIHRoaXMubXlTdWJzLnVuc3Vic2NyaWJlKCk7XG4gIH1cbn1cbiJdfQ==