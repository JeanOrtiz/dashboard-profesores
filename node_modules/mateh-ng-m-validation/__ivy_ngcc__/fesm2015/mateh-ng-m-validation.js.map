{"version":3,"file":"mateh-ng-m-validation.js","sources":["ng:/mateh-ng-m-validation/lib/ng-m-validation.component.ts","ng:/mateh-ng-m-validation/lib/ng-m-validation.module.ts","ng:/mateh-ng-m-validation/lib/form-component-base.ts","ng:/mateh-ng-m-validation/lib/cross-field-error-matcher.ts","ng:/mateh-ng-m-validation/public-api.ts","ng:/mateh-ng-m-validation/mateh-ng-m-validation.ts"],"names":[],"mappings":"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","sourcesContent":["import { Component, OnInit } from '@angular/core';\n\n@Component({\n  selector: 'mateh-ng-m-validation',\n  template: `\n    <p>\n      ng-m-validation works!\n    </p>\n  `,\n  styles: []\n})\nexport class NgMValidationComponentBase implements OnInit {\n\n  constructor() { }\n\n  ngOnInit(): void {\n  }\n\n}\n","import { NgModule } from \"@angular/core\";\nimport { NgMValidationComponentBase } from \"./ng-m-validation.component\";\n// import { CrossFieldErrorMatcher } from \"./cross-field-error-matcher\";\n// import { FormComponentBase } from \"./form-component-base\";\n\n@NgModule({\n  declarations: [\n    NgMValidationComponentBase,\n    // CrossFieldErrorMatcher,\n    // FormComponentBase,\n  ],\n  imports: [],\n  exports: [\n    NgMValidationComponentBase,\n    // CrossFieldErrorMatcher,\n    // FormComponentBase,\n  ],\n})\nexport class NgMValidationModule {}\n","import { ViewChildren, ElementRef, QueryList, OnDestroy } from \"@angular/core\";\nimport {\n  FormControlName,\n  FormGroup,\n  FormArray,\n  ValidatorFn,\n  ValidationErrors,\n} from \"@angular/forms\";\nimport { Observable, fromEvent, merge, Subscriber, Subscription } from \"rxjs\";\nimport { debounceTime } from \"rxjs/operators\";\n\nexport class FormComponentBase implements OnDestroy {\n  @ViewChildren(FormControlName, { read: ElementRef })\n  formInputElements: QueryList<ElementRef>;\n\n  public validationMessages: { [key: string]: { [key: string]: string } } = {};\n  public formErrors: { [key: string]: string } = {};\n\n  mySubs: Subscription;\n\n  protected startControlMonitoring(\n    form: FormGroup,\n    unsubscribePreviousForm = false\n  ): void {\n    if (unsubscribePreviousForm) {\n      this.mySubs.unsubscribe();\n    }\n    // Watch for the blur event from any input element on the form.\n    //  This is required because the valueChanges does not provide notification on blur.\n    this.subscribe(form, this.formInputElements.toArray());\n\n    this.formInputElements.changes.subscribe(\n      (inputs: QueryList<ElementRef>) => {\n        this.subscribe(form, inputs.toArray());\n      }\n    );\n  }\n\n  private subscribe(form: FormGroup, inputsArray: ElementRef[]) {\n    // console.log(inputsArray);\n    const controlBlurs: Observable<\n      any\n    >[] = inputsArray.map((formControl: ElementRef) =>\n      fromEvent(formControl.nativeElement, \"blur\")\n    );\n\n    // Merge the blur event observable with the valueChanges observable so we only need to subscribe once.\n    this.mySubs = merge(form.valueChanges, ...controlBlurs)\n      .pipe(debounceTime(300))\n      .subscribe((value) => {\n        this.logValidationErrors(form);\n      });\n  }\n\n  private logValidationErrors(group: FormGroup | FormArray): void {\n    Object.keys(group.controls).forEach((key: string) => {\n      const abstractControl = group.get(key);\n\n      this.formErrors[key] = \"\";\n      // console.log(key, abstractControl.invalid, abstractControl.touched, abstractControl.dirty);\n      if (\n        abstractControl &&\n        !abstractControl.valid &&\n        (abstractControl.touched || abstractControl.dirty)\n      ) {\n        const messages = this.validationMessages[key];\n        for (const errorKey in abstractControl.errors) {\n          if (errorKey) {\n            this.formErrors[key] += messages[errorKey] + \" \";\n          }\n        }\n      }\n      // console.log(this.formErrors);\n      if (\n        abstractControl instanceof FormGroup ||\n        abstractControl instanceof FormArray\n      ) {\n        this.logValidationErrors(abstractControl);\n      }\n    });\n  }\n\n  atLeastOneCheckboxCheckedValidator(minRequired = 1): ValidatorFn {\n    return function validate(formGroup: FormGroup | FormArray) {\n      let checked = 0;\n\n      Object.keys(formGroup.controls).forEach((key) => {\n        const control = formGroup.controls[key];\n\n        if (control.value) {\n          checked++;\n        }\n      });\n\n      if (checked < minRequired) {\n        return {\n          requireCheckboxToBeChecked: true,\n        };\n      }\n\n      return null;\n    };\n  }\n\n  passwordsMustMatchValidator(): ValidatorFn {\n    return (group: FormGroup): ValidationErrors | null => {\n      const currentPassword = group.get(\"password\");\n      const newPassword = group.get(\"confirmPassword\");\n\n      if (currentPassword && newPassword) {\n        if (currentPassword.pristine || newPassword.pristine) {\n          return null;\n        }\n        if (currentPassword.value !== newPassword.value) {\n          return { passwordsMustMatch: true };\n        }\n      }\n      return null;\n    };\n  }\n\n  ngOnDestroy() {\n    this.mySubs.unsubscribe();\n  }\n}\n","import { ErrorStateMatcher } from \"@angular/material/core/error/error-options\";\nimport { FormControl, FormGroupDirective, NgForm } from \"@angular/forms\";\nimport { Component } from \"@angular/core\";\n\n// @Component({\n//   template: ``,\n// })\nexport class CrossFieldErrorMatcher implements ErrorStateMatcher {\n  isErrorState(\n    control: FormControl | null,\n    form: FormGroupDirective | NgForm | null\n  ): boolean {\n    if (control) {\n      return (control.dirty || control.touched) && control.parent.invalid;\n    }\n    return false;\n  }\n}\n","/*\n * Public API Surface of ng-m-validation\n */\n\nexport * from \"./lib/ng-m-validation.component\";\nexport * from \"./lib/ng-m-validation.module\";\nexport * from \"./lib/form-component-base\";\nexport * from \"./lib/cross-field-error-matcher\";\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"]}