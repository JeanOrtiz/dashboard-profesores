import { __decorate } from "tslib";
import { ViewChildren, ElementRef } from "@angular/core";
import { FormControlName, FormGroup, FormArray, } from "@angular/forms";
import { fromEvent, merge } from "rxjs";
import { debounceTime } from "rxjs/operators";
export class FormComponentBase {
    constructor() {
        this.validationMessages = {};
        this.formErrors = {};
    }
    startControlMonitoring(form, unsubscribePreviousForm = false) {
        if (unsubscribePreviousForm) {
            this.mySubs.unsubscribe();
        }
        // Watch for the blur event from any input element on the form.
        //  This is required because the valueChanges does not provide notification on blur.
        this.subscribe(form, this.formInputElements.toArray());
        this.formInputElements.changes.subscribe((inputs) => {
            this.subscribe(form, inputs.toArray());
        });
    }
    subscribe(form, inputsArray) {
        // console.log(inputsArray);
        const controlBlurs = inputsArray.map((formControl) => fromEvent(formControl.nativeElement, "blur"));
        // Merge the blur event observable with the valueChanges observable so we only need to subscribe once.
        this.mySubs = merge(form.valueChanges, ...controlBlurs)
            .pipe(debounceTime(300))
            .subscribe((value) => {
            this.logValidationErrors(form);
        });
    }
    logValidationErrors(group) {
        Object.keys(group.controls).forEach((key) => {
            const abstractControl = group.get(key);
            this.formErrors[key] = "";
            // console.log(key, abstractControl.invalid, abstractControl.touched, abstractControl.dirty);
            if (abstractControl &&
                !abstractControl.valid &&
                (abstractControl.touched || abstractControl.dirty)) {
                const messages = this.validationMessages[key];
                for (const errorKey in abstractControl.errors) {
                    if (errorKey) {
                        this.formErrors[key] += messages[errorKey] + " ";
                    }
                }
            }
            // console.log(this.formErrors);
            if (abstractControl instanceof FormGroup ||
                abstractControl instanceof FormArray) {
                this.logValidationErrors(abstractControl);
            }
        });
    }
    atLeastOneCheckboxCheckedValidator(minRequired = 1) {
        return function validate(formGroup) {
            let checked = 0;
            Object.keys(formGroup.controls).forEach((key) => {
                const control = formGroup.controls[key];
                if (control.value) {
                    checked++;
                }
            });
            if (checked < minRequired) {
                return {
                    requireCheckboxToBeChecked: true,
                };
            }
            return null;
        };
    }
    passwordsMustMatchValidator() {
        return (group) => {
            const currentPassword = group.get("password");
            const newPassword = group.get("confirmPassword");
            if (currentPassword && newPassword) {
                if (currentPassword.pristine || newPassword.pristine) {
                    return null;
                }
                if (currentPassword.value !== newPassword.value) {
                    return { passwordsMustMatch: true };
                }
            }
            return null;
        };
    }
    ngOnDestroy() {
        this.mySubs.unsubscribe();
    }
}
__decorate([
    ViewChildren(FormControlName, { read: ElementRef })
], FormComponentBase.prototype, "formInputElements", void 0);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZm9ybS1jb21wb25lbnQtYmFzZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL21hdGVoLW5nLW0tdmFsaWRhdGlvbi8iLCJzb3VyY2VzIjpbImxpYi9mb3JtLWNvbXBvbmVudC1iYXNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUUsWUFBWSxFQUFFLFVBQVUsRUFBd0IsTUFBTSxlQUFlLENBQUM7QUFDL0UsT0FBTyxFQUNMLGVBQWUsRUFDZixTQUFTLEVBQ1QsU0FBUyxHQUdWLE1BQU0sZ0JBQWdCLENBQUM7QUFDeEIsT0FBTyxFQUFjLFNBQVMsRUFBRSxLQUFLLEVBQTRCLE1BQU0sTUFBTSxDQUFDO0FBQzlFLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUU5QyxNQUFNLE9BQU8saUJBQWlCO0lBQTlCO1FBSVMsdUJBQWtCLEdBQWlELEVBQUUsQ0FBQztRQUN0RSxlQUFVLEdBQThCLEVBQUUsQ0FBQztJQTRHcEQsQ0FBQztJQXhHVyxzQkFBc0IsQ0FDOUIsSUFBZSxFQUNmLHVCQUF1QixHQUFHLEtBQUs7UUFFL0IsSUFBSSx1QkFBdUIsRUFBRTtZQUMzQixJQUFJLENBQUMsTUFBTSxDQUFDLFdBQVcsRUFBRSxDQUFDO1NBQzNCO1FBQ0QsK0RBQStEO1FBQy9ELG9GQUFvRjtRQUNwRixJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsaUJBQWlCLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQztRQUV2RCxJQUFJLENBQUMsaUJBQWlCLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FDdEMsQ0FBQyxNQUE2QixFQUFFLEVBQUU7WUFDaEMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLEVBQUUsTUFBTSxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUM7UUFDekMsQ0FBQyxDQUNGLENBQUM7SUFDSixDQUFDO0lBRU8sU0FBUyxDQUFDLElBQWUsRUFBRSxXQUF5QjtRQUMxRCw0QkFBNEI7UUFDNUIsTUFBTSxZ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QUFPLEVBQUUsa0JBQWtCLEVBQUUsSUFBSSxFQUFFLENBQUM7aUJBQ3JDO2FBQ0Y7WUFDRCxPQUFPLElBQUksQ0FBQztRQUNkLENBQUMsQ0FBQztJQUNKLENBQUM7SUFFRCxXQUFXO1FBQ1QsSUFBSSxDQUFDLE1BQU0sQ0FBQyxXQUFXLEVBQUUsQ0FBQztJQUM1QixDQUFDO0NBQ0Y7QUEvR0M7SUFEQyxZQUFZLENBQUMsZUFBZSxFQUFFLEVBQUUsSUFBSSxFQUFFLFVBQVUsRUFBRSxDQUFDOzREQUNYIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgVmlld0NoaWxkcmVuLCBFbGVtZW50UmVmLCBRdWVyeUxpc3QsIE9uRGVzdHJveSB9IGZyb20gXCJAYW5ndWxhci9jb3JlXCI7XG5pbXBvcnQge1xuICBGb3JtQ29udHJvbE5hbWUsXG4gIEZvcm1Hcm91cCxcbiAgRm9ybUFycmF5LFxuICBWYWxpZGF0b3JGbixcbiAgVmFsaWRhdGlvbkVycm9ycyxcbn0gZnJvbSBcIkBhbmd1bGFyL2Zvcm1zXCI7XG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBmcm9tRXZlbnQsIG1lcmdlLCBTdWJzY3JpYmVyLCBTdWJzY3JpcHRpb24gfSBmcm9tIFwicnhqc1wiO1xuaW1wb3J0IHsgZGVib3VuY2VUaW1lIH0gZnJvbSBcInJ4anMvb3BlcmF0b3JzXCI7XG5cbmV4cG9ydCBjbGFzcyBGb3JtQ29tcG9uZW50QmFzZSBpbXBsZW1lbnRzIE9uRGVzdHJveSB7XG4gIEBWaWV3Q2hpbGRyZW4oRm9ybUNvbnRyb2xOYW1lLCB7IHJlYWQ6IEVsZW1lbnRSZWYgfSlcbiAgZm9ybUlucHV0RWxlbWVudHM6IFF1ZXJ5TGlzdDxFbGVtZW50UmVmPjtcblxuICBwdWJsaWMgdmFsaWRhdGlvbk1lc3NhZ2VzOiB7IFtrZXk6IHN0cmluZ106IHsgW2tleTogc3RyaW5nXTogc3RyaW5nIH0gfSA9IHt9O1xuICBwdWJsaWMgZm9ybUVycm9yczogeyBba2V5OiBzdHJpbmddOiBzdHJpbmcgfSA9IHt9O1xuXG4gIG15U3ViczogU3Vic2NyaXB0aW9uO1xuXG4gIHByb3RlY3RlZCBzdGFydENvbnRyb2xNb25pdG9yaW5nKFxuICAgIGZvcm06IEZvcm1Hcm91cCxcbiAgICB1bnN1YnNjcmliZVByZXZpb3VzRm9ybSA9IGZhbHNlXG4gICk6IHZvaWQge1xuICAgIGlmICh1bnN1YnNjcmliZVByZXZpb3VzRm9ybSkge1xuICAgICAgdGhpcy5teVN1YnMudW5zdWJzY3JpYmUoKTtcbiAgICB9XG4gICAgLy8gV2F0Y2ggZm9yIHRoZSBibHVyIGV2ZW50IGZyb20gYW55IGlucHV0IGVsZW1lbnQgb24gdGhlIGZvcm0uXG4gICAgLy8gIFRoaXMgaXMgcmVxdWlyZWQgYmVjYXVzZSB0aGUgdmFsdWVDaGFuZ2VzIGRvZXMgbm90IHByb3ZpZGUgbm90aWZpY2F0aW9uIG9uIGJsdXIuXG4gICAgdGhpcy5zdWJzY3JpYmUoZm9ybSwgdGhpcy5mb3JtSW5wdXRFbGVtZW50cy50b0FycmF5KCkpO1xuXG4gICAgdGhpcy5mb3JtSW5wdXRFbGVtZW50cy5jaGFuZ2VzLnN1YnNjcmliZShcbiAgICAgIChpbnB1dHM6IFF1ZXJ5TGlzdDxFbGVtZW50UmVmPikgPT4ge1xuICAgICAgICB0aGlzLnN1YnNjcmliZShmb3JtLCBpbnB1dHMudG9BcnJheSgpKTtcbiAgICAgIH1cbiAgICApO1xuICB9XG5cbiAgcHJpdmF0ZSBzdWJzY3JpYmUoZm9ybTogRm9ybUdyb3VwLCBpbnB1dHNBcnJheTogRWxlbWVudFJlZltdKSB7XG4gICAgLy8gY29uc29sZS5sb2coaW5wdXRzQXJyYXkpO1xuICAgIGNvbnN0IGNvbnRyb2xCbHVyczogT2JzZXJ2YWJsZTxcbiAgICAgIGFueVxuICAgID5bXSA9IGlucHV0c0FycmF5Lm1hcCgoZm9ybUNvbnRyb2w6IEVsZW1lbnRSZWYpID0+XG4gICAgICBmcm9tRXZlbnQoZm9ybUNvbnRyb2wubmF0aXZlRWxlbWVudCwgXCJibHVyXCIpXG4gICAgKTtcblxuICAgIC8vIE1lcmdlIHRoZSBibHVyIGV2ZW50IG9ic2VydmFibGUgd2l0aCB0aGUgdmFsdWVDaGFuZ2VzIG9ic2VydmFibGUgc28gd2Ugb25seSBuZWVkIHRvIHN1YnNjcmliZSBvbmNlLlxuICAgIHRoaXMubXlTdWJzID0gbWVyZ2UoZm9ybS52YWx1ZUNoYW5nZXMsIC4uLmNvbnRyb2xCbHVycylcbiAgICAgIC5waXBlKGRlYm91bmNlVGltZSgzMDApKVxuICAgICAgLnN1YnNjcmliZSgodmFsdWUpID0+IHtcbiAgICAgICAgdGhpcy5sb2dWYWxpZGF0aW9uRXJyb3JzKGZvcm0pO1xuICAgICAgfSk7XG4gIH1cblxuICBwcml2YXRlIGxvZ1ZhbGlkYXRpb25FcnJvcnMoZ3JvdXA6IEZvcm1Hcm91cCB8IEZvcm1BcnJheSk6IHZvaWQge1xuICAgIE9iamVjdC5rZXlzKGdyb3VwLmNvbnRyb2xzKS5mb3JFYWNoKChrZXk6IHN0cmluZykgPT4ge1xuICAgICAgY29uc3QgYWJzdHJhY3RDb250cm9sID0gZ3JvdXAuZ2V0KGtleSk7XG5cbiAgICAgIHRoaXMuZm9ybUVycm9yc1trZXldID0gXCJcIjtcbiAgICAgIC8vIGNvbnNvbGUubG9nKGtleSwgYWJzdHJhY3RDb250cm9sLmludmFsaWQsIGFic3RyYWN0Q29udHJvbC50b3VjaGVkLCBhYnN0cmFjdENvbnRyb2wuZGlydHkpO1xuICAgICAgaWYgKFxuICAgICAgICBhYnN0cmFjdENvbnRyb2wgJiZcbiAgICAgICAgIWFic3RyYWN0Q29udHJvbC52YWxpZCAmJlxuICAgICAgICAoYWJzdHJhY3RDb250cm9sLnRvdWNoZWQgfHwgYWJzdHJhY3RDb250cm9sLmRpcnR5KVxuICAgICAgKSB7XG4gICAgICAgIGNvbnN0IG1lc3NhZ2VzID0gdGhpcy52YWxpZGF0aW9uTWVzc2FnZXNba2V5XTtcbiAgICAgICAgZm9yIChjb25zdCBlcnJvcktleSBpbiBhYnN0cmFjdENvbnRyb2wuZXJyb3JzKSB7XG4gICAgICAgICAgaWYgKGVycm9yS2V5KSB7XG4gICAgICAgICAgICB0aGlzLmZvcm1FcnJvcnNba2V5XSArPSBtZXNzYWdlc1tlcnJvcktleV0gKyBcIiBcIjtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIC8vIGNvbnNvbGUubG9nKHRoaXMuZm9ybUVycm9ycyk7XG4gICAgICBpZiAoXG4gICAgICAgIGFic3RyYWN0Q29udHJvbCBpbnN0YW5jZW9mIEZvcm1Hcm91cCB8fFxuICAgICAgICBhYnN0cmFjdENvbnRyb2wgaW5zdGFuY2VvZiBGb3JtQXJyYXlcbiAgICAgICkge1xuICAgICAgICB0aGlzLmxvZ1ZhbGlkYXRpb25FcnJvcnMoYWJzdHJhY3RDb250cm9sKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIGF0TGVhc3RPbmVDaGVja2JveENoZWNrZWRWYWxpZGF0b3IobWluUmVxdWlyZWQgPSAxKTogVmFsaWRhdG9yRm4ge1xuICAgIHJldHVybiBmdW5jdGlvbiB2YWxpZGF0ZShmb3JtR3JvdXA6IEZvcm1Hcm91cCB8IEZvcm1BcnJheSkge1xuICAgICAgbGV0IGNoZWNrZWQgPSAwO1xuXG4gICAgICBPYmplY3Qua2V5cyhmb3JtR3JvdXAuY29udHJvbHMpLmZvckVhY2goKGtleSkgPT4ge1xuICAgICAgICBjb25zdCBjb250cm9sID0gZm9ybUdyb3VwLmNvbnRyb2xzW2tleV07XG5cbiAgICAgICAgaWYgKGNvbnRyb2wudmFsdWUpIHtcbiAgICAgICAgICBjaGVja2VkKys7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICBpZiAoY2hlY2tlZCA8IG1pblJlcXVpcmVkKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgcmVxdWlyZUNoZWNrYm94VG9CZUNoZWNrZWQ6IHRydWUsXG4gICAgICAgIH07XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBudWxsO1xuICAgIH07XG4gIH1cblxuICBwYXNzd29yZHNNdXN0TWF0Y2hWYWxpZGF0b3IoKTogVmFsaWRhdG9yRm4ge1xuICAgIHJldHVybiAoZ3JvdXA6IEZvcm1Hcm91cCk6IFZhbGlkYXRpb25FcnJvcnMgfCBudWxsID0+IHtcbiAgICAgIGNvbnN0IGN1cnJlbnRQYXNzd29yZCA9IGdyb3VwLmdldChcInBhc3N3b3JkXCIpO1xuICAgICAgY29uc3QgbmV3UGFzc3dvcmQgPSBncm91cC5nZXQoXCJjb25maXJtUGFzc3dvcmRcIik7XG5cbiAgICAgIGlmIChjdXJyZW50UGFzc3dvcmQgJiYgbmV3UGFzc3dvcmQpIHtcbiAgICAgICAgaWYgKGN1cnJlbnRQYXNzd29yZC5wcmlzdGluZSB8fCBuZXdQYXNzd29yZC5wcmlzdGluZSkge1xuICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjdXJyZW50UGFzc3dvcmQudmFsdWUgIT09IG5ld1Bhc3N3b3JkLnZhbHVlKSB7XG4gICAgICAgICAgcmV0dXJuIHsgcGFzc3dvcmRzTXVzdE1hdGNoOiB0cnVlIH07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBudWxsO1xuICAgIH07XG4gIH1cblxuICBuZ09uRGVzdHJveSgpIHtcbiAgICB0aGlzLm15U3Vicy51bnN1YnNjcmliZSgpO1xuICB9XG59XG4iXX0=